



Oblivious HTTP Application Intermediation                       T. Pauly
Internet-Draft                                                Apple Inc.
Intended status: Informational                                  T. Reddy
Expires: 6 January 2023                                           Akamai
                                                             5 July 2022


      Discovery of Oblivious Services via Service Binding Records
                  draft-pauly-ohai-svcb-config-latest

Abstract

   This document defines a parameter that can be included in SVCB and
   HTTPS DNS resource records to denote that a service is accessible
   using Oblivious HTTP, with an indication of which Oblivious Gateway
   Resource to use to access the service (aa an Oblivious Target
   Resource).  This document also defines mechanisms to learn more
   details about the related Oblivious Gateway Resource, such as its key
   configuration.

About This Document

   This note is to be removed before publishing as an RFC.

   Status information for this document may be found at
   https://datatracker.ietf.org/doc/draft-pauly-ohai-svcb-config/.

   Discussion of this document takes place on the Oblivious HTTP
   Application Intermediation Working Group mailing list
   (mailto:ohai@ietf.org), which is archived at
   https://mailarchive.ietf.org/arch/browse/ohai/.

   Source for this draft and an issue tracker can be found at
   https://github.com/tfpauly/draft-ohai-svcb-config.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 6 January 2023.

Copyright Notice

   Copyright (c) 2022 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction
   2.  Conventions and Definitions
   3.  The oblivious-gateway SvcParamKey
     3.1.  Use in HTTPS service records
     3.2.  Use in DNS server SVCB records
       3.2.1.  Use with DDR
       3.2.2.  Use with DNR
   4.  Key Configuration Well-Known URI
   5.  Oblivious Gateway Resource Well-Known URI
   6.  Security and Privacy Considerations
   7.  IANA Considerations
     7.1.  SVCB Service Parameter
     7.2.  Well-Known URIs
       7.2.1.  oblivious-configs
       7.2.2.  oblivious-gateway
   8.  References
     8.1.  Normative References
     8.2.  Informative References
   Authors' Addresses

1.  Introduction

   Oblivious HTTP [OHTTP] allows clients to encrypt messages exchanged
   with an Oblivious Target Resource (target).  The messages are
   encapsulated in encrypted messages to an Oblivious Gateway Resource
   (gateway), which gates access to the target.  The gateway is access
   via an Oblivious Relay Resource (relay), which proxies the
   encapsulated messages to hide the identity of the client.  Overall,
   this architecture is designed in such a way that the relay cannot
   inspect the contents of messages, and the gateway and target cannot
   discover the client's identity.

   Since Oblivious HTTP deployments will often involve very specific
   coordination between clients, relays, and gateways, the key
   configuration can often be shared in a bespoke fashion.  However,
   some deployments involve clients discovering oblivious targets and
   their assoicated gateways more dynamically.  For example, a network
   may want to advertise a DNS resolver that is accessible over
   Oblivious HTTP and applies local network resolution policies via
   mechanisms like Discovery of Designated Resolvers ([DDR].  Clients
   can work with trusted relays to access these gateways.

   This document defines a mechanism to advertise that an HTTP service
   supports Oblivious HTTP using DNS records, as a parameter that can be
   included in SVCB and HTTPS DNS resource records [SVCB].  The presence
   of this parameter indicates that a service can act as an oblivious
   target, and indicates an oblivious gateway that can provide access to
   the target.

   This document also defines two well-known URIs [RFC8615], which are
   access on the oblivious gateway indicated in the SVCB record.

   *  "oblivious-configs", which can be used to look up key
      configurations on a host that has been identified as an oblivious
      gateway using SVCB records (Section 4); and,

   *  "oblivious-gateway", which can be used to send oblivious gateway
      requests to a host that has been identified as an oblivious
      gateway using SVCB records (Section 5).

   This mechanism does not aid in the discovery of oblivious relays; the
   configuration of relays is out of scope for this document.

2.  Conventions and Definitions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  The oblivious-gateway SvcParamKey

   The "oblivious-gateway" SvcParamKey (Section 7) is used to indicate
   that a service described in an SVCB record can be accessed as an
   oblivious target using the specified gateway.  The service that is
   queried by the client hosts one or more target resources.  The
   gateway is a separate resource that is indicated by the SVCB record
   parameter, which allows oblivious access to any target resource
   hosted by the service described in the SVCB record.

   In order to access the service's target resources obliviously, the
   client needs to send encapsulated messages to the gateway resource
   using the gateway's key configuration (which can be retrieved using
   the method described in Section 4).

   The presentation format of the "oblivious-gateway" parameter is a
   comma-separated list of one or more hostnames.  The wire format
   consists of one or more hostnames, each prefixed by its length as a
   single octet, with these length-value pairs concatenated to form the
   SvcParamValue.  These pairs MUST exactly fill the SvcParamValue;
   otherwise, the SvcParamValue is malformed.

   The "oblivious-gateway" parameter can be included in the mandatory
   parameter list to ensure that clients that do not support oblivious
   access do not try to use the service.  Services that mark the
   oblivious-gateway parameter as mandatory can, therefore, indicate
   that the service might not be accessible in a non-oblivious fashion.
   Services that are intended to be accessed either with an oblivious
   gateway or directly SHOULD NOT mark the "oblivious-gateway" parameter
   as mandatory.  Note that since multiple SVCB responses can be
   provided for a single query, the oblivious and non-oblivious versions
   of a single service can have different SVCB records to support
   different names or properties.

   The media type to use for encapsulated requests made to a target
   service depends on the scheme of the SVCB record.  This document
   defines the interpretation for the "https" [SVCB] and "dns"
   [DNS-SVCB] schemes.  Other schemes that want to use this parameter
   MUST define the interpretation and meaning of the configuration.

3.1.  Use in HTTPS service records

   For the "https" scheme, which uses the HTTPS RR type instead of SVCB,
   the presence of the "oblivious-gateway" parameter means that the
   target being described is an Oblivious HTTP service that uses the
   default "message/bhttp" media type [OHTTP] [BINARY-HTTP].

   For example, an HTTPS service record for svc.example.com that
   supports an oblivious gateway could look like this:

   svc.example.com. 7200  IN HTTPS 1 . (
        alpn=h2 oblivious-gateway=osvc.example.com )

   A similar record for a service that only support oblivious
   connectivity could look like this:

   svc.example.com. 7200  IN HTTPS 1 . (
       mandatory=oblivious-gateway oblivious-gateway=osvc.example.com )

3.2.  Use in DNS server SVCB records

   For the "dns" scheme, as defined in [DNS-SVCB], the presence of the
   "oblivious-gateway" parameter means that the DNS server being
   described is an Oblivious DNS over HTTP (DoH) service.  The default
   media type expected for use in Oblivious HTTP to DNS resolvers is
   "application/dns-message" [DOH].

   In order for DNS servers to function as oblivious targets, their
   associated gateways need to be accessible via an oblivious relay.
   Encrypted DNS servers used with the discovery mechanisms described in
   this section can either be publicly accessible, or specific to a
   network.  In general, only publicly accessible DNS servers will work
   as oblivious DNS servers, unless there is a coordinated deployment
   with an oblivious relay that is also hosted within a network.

3.2.1.  Use with DDR

   Clients can discover an oblivious DNS server configuration using DDR,
   by either querying _dns.resolver.arpa to a locally configured
   resolver or querying using the name of a resolver [DDR].

   For example, a DoH service advertised over DDR can be annotated as
   supporting oblivious resolution using the following record:

   _dns.resolver.arpa  7200  IN SVCB 1 doh.example.net (
        alpn=h2 dohpath=/dns-query{?dns}
        oblivious-gateway=odoh.example.net  )

   Clients still need to perform some verification of oblivious DNS
   servers, such as the TLS certificate check described in [DDR].  This
   certificate check can be done when looking up the configuration on
   the resolver using the well-known URI (Section 4), which can either
   be done directly, or via a proxy to avoid exposing client IP
   addresses.

   Clients also need to ensure that they are not being targeted with
   unique key configurations that would reveal their identity.  See
   Section 6 for more discussion.

3.2.2.  Use with DNR

   The SvcParamKeys defined in this document also can be used with
   Discovery of Network-designated Resolvers (DNR) [DNR].  In this case,
   the oblivious configuration and path parameters can be included in
   DHCP and Router Advertisement messages.

   While DNR does not require the same kind of verification as DDR,
   clients still need to ensure that they are not being targeted with
   unique key configurations that would reveal their identity.  See
   Section 6 for more discussion.

4.  Key Configuration Well-Known URI

   Clients that know a service is available as an oblivious target via
   discovery through the "oblivious-gateway" parameter in a SVCB or
   HTTPS record need to know the key configuration of the gateway before
   sending oblivious requests.

   This document defines a well-known URI [RFC8615], "oblivious-
   configs", that allows a gateway to host its configurations.

   The URI is constructed using the name in the "oblivious-gateway" SVCB
   parameter.

   For example, the configuration URI for the following record:

   svc.example.com. 7200  IN HTTPS 1 . (
        alpn=h2 oblivious-gateway=osvc.example.com )

   would be "https://osvc.example.com/.well-known/oblivious-configs".

   As another example, the configuration URI for the following record:

   _dns.resolver.arpa  7200  IN SVCB 1 doh.example.net (
        alpn=h2 dohpath=/dns-query{?dns}
        oblivious-gateway=odoh.example.net )

   would be "https://odoh.example.net/.well-known/oblivious-configs".

   The content of this resource is expected to be "application/ohttp-
   keys", as defined in [OHTTP].

   Before being able send messages through an oblivious gateway, clients
   need to use this URI to fetch the configuration.  They can either
   fetch it directly, or do so via a proxy in order to avoid the server
   discovering information about the client's identity.  See Section 6
   for more discussion of avoiding key targeting attacks.

5.  Oblivious Gateway Resource Well-Known URI

   Oblivious gateways that are advertised via SVCB or HTTPS records need
   to receive gateway requests (sent from oblivious relays) on a
   particular path.  While oblivious gateways in general do not require
   fixed or well-known paths, since they can use ad-hoc configurations
   with clients and relays, gateways discovered using the method
   described in this document need to offer a well-known path.

   Offering a single, well-known URI for each discovered gateway name
   allows for simpler lookup of associated key configurations, simpler
   communication between clients and relays, and makes client-targeting
   attacks more difficult to execute.  See Section 6 for more
   discussion.

   This document defines a well-known URI [RFC8615], "oblivious-
   gateway", which an oblivious gateway uses to receive gateway
   requests.

   The URI is constructed using the name in the "oblivious-gateway" SVCB
   parameter.

   For example, the oblivious request URI for the following record:

   svc.example.com. 7200  IN HTTPS 1 . (
        alpn=h2 oblivious-gateway=osvc.example.com )

   would be "https://osvc.example.com/.well-known/oblivious-gateway".

   Request to this resource are expected to use the content type
   "message/ohttp-req", and responses are expected to use "message/
   ohttp-res", as defined in [OHTTP].

6.  Security and Privacy Considerations

   Attackers on a network can remove SVCB information from cleartext DNS
   answers that are not protected by DNSSEC [DNSSEC].  This can
   effectively downgrade clients.  However, since SVCB indications for
   oblivious support are just hints, a client can mitigate this by
   always checking for oblivious gateway information.  Use of encrypted
   DNS or DNSSEC also can be used as mitigations.

   When discovering designated oblivious DNS servers using this
   mechanism, clients need to ensure that the designation is trusted in
   lieu of being able to directly check the contents of the gateway
   server's TLS certificate.  See Section 3.2.1 for more discussion, as
   well as the Security Considerations of [I-D.ietf-add-svcb-dns].

   As discussed in [OHTTP], client requests using Oblivious HTTP can
   only be linked by recognizing the key configuration.  In order to
   prevent unwanted linkability and tracking, clients using any key
   configuration discovery mechanism need to be concerned with attacks
   that target a specific user or population with a unique key
   configuration.

   There are several approaches clients can use to mitigate key
   targeting attacks.  [CONSISTENCY] provides an analysis of the options
   for ensuring the key configurations are consistent between different
   clients.  Clients SHOULD employ some technique to mitigate key
   targeting attack.  Oblivious gateways that are detected to use
   targeted key configurations per-client MUST NOT be used.

   Oblivious gateways that are accessed based on SVCB discovery are
   required to offer a well-known oblivious gateway request path.  This
   is done in part to make client-targeting attacks more difficult.  If
   the gateway request path is communicated in the SVCB parameters,
   individual clients could receive unique paths which could be used to
   identify them upon making requests via a relay.  While it is still
   possible for different clients to receive different gateway names,
   this requires provisioning more gateway names (which has overhead in
   DNS configuration and TLS certificate generation), and allows relays
   to more easily enforce allow-lists of known gateway names without
   needing to also check request paths.

   When clients fetch a gateway's configuration using the well-known
   URI, they can expose their identity in the form of an IP address if
   they do not connect via a proxy or some other IP-hiding mechanism.
   Clients SHOULD use a proxy or similar mechanism to avoid exposing
   client IPs to a gateway.

7.  IANA Considerations

7.1.  SVCB Service Parameter

   IANA is requested to add the following entry to the SVCB Service
   Parameters registry ([SVCB]).

    +========+===================+========================+===========+
    | Number | Name              | Meaning                | Reference |
    +========+===================+========================+===========+
    | TBD    | oblivious-gateway | Defines an oblivious   | (This     |
    |        |                   | HTTP gateway to use to | document) |
    |        |                   | access this resource   |           |
    +--------+-------------------+------------------------+-----------+

                                  Table 1

7.2.  Well-Known URIs

   IANA is requested to add two new entries in the "Well-Known URIs"
   registry [RFC8615].

7.2.1.  oblivious-configs

   URI suffix: oblivious-configs

   Change controller: IETF

   Specification document: This document

   Status: permanent

   Related information: N/A

7.2.2.  oblivious-gateway

   URI suffix: oblivious-gateway

   Change controller: IETF

   Specification document: This document

   Status: permanent

   Related information: N/A

8.  References

8.1.  Normative References

   [BINARY-HTTP]
              Thomson, M. and C. A. Wood, "Binary Representation of HTTP
              Messages", Work in Progress, Internet-Draft, draft-ietf-
              httpbis-binary-message-05, 9 June 2022,
              <https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-
              binary-message-05>.

   [DDR]      Pauly, T., Kinnear, E., Wood, C. A., McManus, P., and T.
              Jensen, "Discovery of Designated Resolvers", Work in
              Progress, Internet-Draft, draft-ietf-add-ddr-07, 24 June
              2022, <https://datatracker.ietf.org/doc/html/draft-ietf-
              add-ddr-07>.

   [DNR]      Boucadair, M., Reddy, T., Wing, D., Cook, N., and T.
              Jensen, "DHCP and Router Advertisement Options for the
              Discovery of Network-designated Resolvers (DNR)", Work in
              Progress, Internet-Draft, draft-ietf-add-dnr-09, 24 June
              2022, <https://datatracker.ietf.org/doc/html/draft-ietf-
              add-dnr-09>.

   [DNS-SVCB] Schwartz, B., "Service Binding Mapping for DNS Servers",
              Work in Progress, Internet-Draft, draft-ietf-add-svcb-dns-
              05, 24 June 2022, <https://datatracker.ietf.org/doc/html/
              draft-ietf-add-svcb-dns-05>.

   [DOH]      Hoffman, P. and P. McManus, "DNS Queries over HTTPS
              (DoH)", RFC 8484, DOI 10.17487/RFC8484, October 2018,
              <https://www.rfc-editor.org/rfc/rfc8484>.

   [OHTTP]    Thomson, M. and C. A. Wood, "Oblivious HTTP", Work in
              Progress, Internet-Draft, draft-ietf-ohai-ohttp-01, 15
              February 2022, <https://datatracker.ietf.org/doc/html/
              draft-ietf-ohai-ohttp-01>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/rfc/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/rfc/rfc8174>.

   [RFC8615]  Nottingham, M., "Well-Known Uniform Resource Identifiers
              (URIs)", RFC 8615, DOI 10.17487/RFC8615, May 2019,
              <https://www.rfc-editor.org/rfc/rfc8615>.

   [SVCB]     Schwartz, B., Bishop, M., and E. Nygren, "Service binding
              and parameter specification via the DNS (DNS SVCB and
              HTTPS RRs)", Work in Progress, Internet-Draft, draft-ietf-
              dnsop-svcb-https-10, 24 May 2022,
              <https://datatracker.ietf.org/doc/html/draft-ietf-dnsop-
              svcb-https-10>.

8.2.  Informative References

   [CONSISTENCY]
              Davidson, A., Finkel, M., Thomson, M., and C. A. Wood,
              "Key Consistency and Discovery", Work in Progress,
              Internet-Draft, draft-wood-key-consistency-02, 4 March
              2022, <https://datatracker.ietf.org/doc/html/draft-wood-
              key-consistency-02>.

   [DNSSEC]   Arends, R., Austein, R., Larson, M., Massey, D., and S.
              Rose, "DNS Security Introduction and Requirements",
              RFC 4033, DOI 10.17487/RFC4033, March 2005,
              <https://www.rfc-editor.org/rfc/rfc4033>.

   [I-D.ietf-add-svcb-dns]
              Schwartz, B., "Service Binding Mapping for DNS Servers",
              Work in Progress, Internet-Draft, draft-ietf-add-svcb-dns-
              05, 24 June 2022, <https://datatracker.ietf.org/doc/html/
              draft-ietf-add-svcb-dns-05>.

Authors' Addresses

   Tommy Pauly
   Apple Inc.
   Email: tpauly@apple.com


   Tirumaleswar Reddy
   Akamai
   Email: kondtir@gmail.com
